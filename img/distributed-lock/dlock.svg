<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="434px" preserveAspectRatio="none" style="width:662px;height:434px;" version="1.1" viewBox="0 0 662 434" width="662px" zoomAndPan="magnify"><defs><filter height="300%" id="fux1bc25tx5sc" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fux1bc25tx5sc)" height="336.4609" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="40" y="48.2969"/><rect fill="#FFFFFF" filter="url(#fux1bc25tx5sc)" height="315.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="389" y="69.4297"/><rect fill="#FFFFFF" filter="url(#fux1bc25tx5sc)" height="75.3984" style="stroke: #000000; stroke-width: 2.0;" width="287" x="359" y="84.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="45" x2="45" y1="38.2969" y2="393.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="394" x2="394" y1="38.2969" y2="393.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="546.5" x2="546.5" y1="38.2969" y2="393.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="620.5" x2="620.5" y1="38.2969" y2="393.7578"/><rect fill="#FEFECE" filter="url(#fux1bc25tx5sc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="15" y="22.9951">业务系统</text><rect fill="#FEFECE" filter="url(#fux1bc25tx5sc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="8" y="392.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="15" y="412.7529">业务系统</text><rect fill="#FEFECE" filter="url(#fux1bc25tx5sc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="369" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="376" y="22.9951">Lock</text><rect fill="#FEFECE" filter="url(#fux1bc25tx5sc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="369" y="392.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="376" y="412.7529">Lock</text><rect fill="#FEFECE" filter="url(#fux1bc25tx5sc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="518.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="525.5" y="22.9951">Redis</text><rect fill="#FEFECE" filter="url(#fux1bc25tx5sc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="518.5" y="392.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="525.5" y="412.7529">Redis</text><rect fill="#FEFECE" filter="url(#fux1bc25tx5sc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="66" x="585.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="592.5" y="22.9951">Monitor</text><rect fill="#FEFECE" filter="url(#fux1bc25tx5sc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="66" x="585.5" y="392.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="592.5" y="412.7529">Monitor</text><rect fill="#FFFFFF" filter="url(#fux1bc25tx5sc)" height="336.4609" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="40" y="48.2969"/><rect fill="#FFFFFF" filter="url(#fux1bc25tx5sc)" height="315.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="389" y="69.4297"/><polygon fill="#A80036" points="377,65.4297,387,69.4297,377,73.4297,381,69.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="50" x2="383" y1="69.4297" y2="69.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="57" y="64.3638">tryLock(unlockTimeoutMillisecond, waitMillisecond)</text><path d="M359,84.4297 L436,84.4297 L436,91.4297 L426,101.4297 L359,101.4297 L359,84.4297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="75.3984" style="stroke: #000000; stroke-width: 2.0;" width="287" x="359" y="84.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="374" y="97.4966">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="190" x="451" y="96.6401">[waitMillisecond &amp; !isLocked]</text><polygon fill="#A80036" points="535,118.6953,545,122.6953,535,126.6953,539,122.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="399" x2="541" y1="122.6953" y2="122.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="406" y="117.6294">(SETNX + EXPIRED)</text><polygon fill="#A80036" points="410,147.8281,400,151.8281,410,155.8281,406,151.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="404" x2="546" y1="151.8281" y2="151.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="416" y="146.7622">success</text><polygon fill="#A80036" points="61,183.9609,51,187.9609,61,191.9609,57,187.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="55" x2="388" y1="187.9609" y2="187.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="67" y="182.895">success</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="618.5" x2="608.5" y1="217.0938" y2="213.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="618.5" x2="608.5" y1="217.0938" y2="221.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="399" x2="619.5" y1="217.0938" y2="217.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="406" y="212.0278">数据上报</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="50" x2="92" y1="246.2266" y2="246.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="92" x2="92" y1="246.2266" y2="259.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="92" y1="259.2266" y2="259.2266"/><polygon fill="#A80036" points="61,255.2266,51,259.2266,61,263.2266,57,259.2266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="57" y="241.1606">doSomething()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="387" x2="377" y1="288.3594" y2="284.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="387" x2="377" y1="288.3594" y2="292.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="50" x2="388" y1="288.3594" y2="288.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="57" y="283.2935">unlock()</text><polygon fill="#A80036" points="535,313.4922,545,317.4922,535,321.4922,539,317.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="399" x2="541" y1="317.4922" y2="317.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="406" y="312.4263">(DEL KEY, CAS)</text><polygon fill="#A80036" points="410,342.625,400,346.625,410,350.625,406,346.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="404" x2="546" y1="346.625" y2="346.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="416" y="341.5591">success</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="618.5" x2="608.5" y1="375.7578" y2="371.7578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="618.5" x2="608.5" y1="375.7578" y2="379.7578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="399" x2="619.5" y1="375.7578" y2="375.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="406" y="370.6919">数据上报</text><!--
@startuml
activate 业务系统
业务系统 -> Lock: tryLock(unlockTimeoutMillisecond, waitMillisecond)
activate Lock
loop waitMillisecond & !isLocked
	Lock -> Redis: (SETNX + EXPIRED)
	Redis - -> Lock: success 
end
Lock - -> 业务系统: success
Lock ->> Monitor: 数据上报

业务系统 -> 业务系统: doSomething()
业务系统 ->> Lock: unlock()
Lock -> Redis: (DEL KEY, CAS)
Redis - -> Lock: success
Lock ->> Monitor: 数据上报
@enduml

PlantUML version 1.2018.08(Sun Jun 24 12:31:00 UTC 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>